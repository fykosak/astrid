#!python

import cherrypy
import astrid
import sys
import os

from cherrypy.process.plugins import Daemonizer
from cherrypy.process.plugins import PIDFile

if len(sys.argv) < 2:
    pidfile = os.path.expanduser("~/.astrid/pidfile")
else:
    pidfile = sys.argv[1]

print("Using pidfile %s" % pidfile)

Daemonizer(cherrypy.engine).subscribe()
PIDFile(cherrypy.engine, pidfile=pidfile).subscribe()

cherrypy.tree.mount(astrid.root, "/", config=astrid.config)
cherrypy.engine.start()
cherrypy.engine.block()
